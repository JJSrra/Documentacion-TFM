\chapter{Nuevas propuestas aportadas al estudio}

En este capítulo se realizará un análisis sobre los distintos métodos ideados para competir contra el sistema de recomendación del estado del arte que se ha escogido como referencia. La idea es proponer una serie de alternativas que puedan resultar interesantes y que se espera que mejoren la eficacia de dicho método.

Como se ha mencionado en el capítulo anterior, el principal criterio que se ha seguido para escoger el método del estado del arte es, aparte de la intrínseca necesidad de tratarse de un algoritmo actual, que reproduzca en su algoritmo un comportamiento social que se asemeje a la toma de decisiones que realizan los seres humanos a la hora de enfrentarse a un problema así. En el caso del sistema de recomendación de referencia, su algoritmo se basa en decidir qué usuario es más representativo para el grupo en función de la lista de preferencias que tiene cada miembro. Para los métodos propios de este estudio se han planteado las siguientes propuestas:

\begin{itemize}
	\item \textbf{Método de empatía}
	\item \textbf{Método del más cinéfilo}
	\item \textbf{Método del más optimista}
	\item \textbf{Método de mayor similitud}
\end{itemize}

A lo largo de las próximas páginas se realizará un análisis más detallado acerca de cada uno de estos métodos, así como de dónde ha surgido la idea de cada uno y cómo puede asemejarse a un comportamiento social. Además se explicará su funcionamiento mediante pseudocódigo acompañado de una descripción del mismo en lenguaje natural.

\section{Método de empatía}

La idea para esta primera propuesta surgió desde el inicio del estudio, ya que fue un factor que no se identificó en prácticamente ningún sistema de recomendación a grupos del estado del arte. En el recomendador \textit{HappyMovie} \cite{happymovie2011} aparecía el concepto de \textit{fairness}, algo así como la ``justicia'' a la hora de realizar recomendaciones al grupo. Sin embargo, en dicha publicación no se hace referencia al método que utilizan para medir, estimar y recalcular el valor de \textit{fairness} a lo largo del tiempo. Dada la naturaleza del concepto, este valor tiene necesariamente que ser dinámico y actualizarse en función de lo que haya ocurrido en iteraciones pasadas. En este punto se decidió que una de las nuevas propuestas del estudio fuera \textbf{un sistema de recomendación a grupos capaz de ser empático} con todos los miembros del mismo.

La premisa para este algoritmo es sencilla, pero lógica: dar más importancia a las preferencias de aquellos usuarios a los que menos les hayan gustado las últimas películas recomendadas. A un usuario al que no le hayan gustado nada las últimas tres películas recomendadas se le tendrá muy en cuenta a la hora de decidir la siguiente, de la misma manera que a una persona a la que le han maravillado esas mismas películas no le importará que la siguiente le guste un poco menos.

Si se habla de un grupo de amigos que van a ver una película, este algoritmo tiene especial sentido, ya que se entiende que todos los miembros buscan el interés general del grupo además de su propio beneficio. Estar dispuesto a hacer concesiones, o ``sacrificar'' una elección óptima para que otra parte del grupo obtenga una opción mejor hace que el grupo se equilibre y puede dar lugar a una recomendación interesante desde el punto de vista algorítmico -- a través de la experimentación se dictaminará si también lo es desde el punto de vista de la eficacia.

A continuación se muestra un fragmento de pseudocódigo que representa el método de recomendación basado en empatía:
\newpage

\begin{algorithm}
	\caption{Método de empatía}
	\begin{algorithmic}[1]
		\State $valoraciones \gets predecirValoraciones()$
		\For{\textit{usuario} \textbf{in} \textit{grupo}}
		\State \textbf{Añadir} $\frac{1}{size(grupo)}$ \textbf{a} \textit{pesos}
		\EndFor
		\State $ranking \gets []$
		\While{\textit{size(películas)} \textbf{$> 1$}}
		\State $valoracionesPonderadas \gets valoraciones \times pesos$
		\State \textit{películaRecomendada} $ \gets max(valoracionesPonderadas)$
		\State $pesos \gets actualizarPesos()$
		\State \textbf{Eliminar} \textit{películaRecomendada} \textbf{de} \textit{valoraciones} \textbf{y} \textit{películas}
		\State \textbf{Añadir} \textit{películaRecomendada} \textbf{a} \textit{ranking}
		\EndWhile
		\State \textbf{Añadir última} \textit{película} \textbf{a} \textit{ranking}
		\State{\textbf{return} \textit{ranking}}
	\end{algorithmic}
\end{algorithm}

\begin{algorithm}
	\caption{Actualización de pesos para el método de empatía}
	\begin{algorithmic}[1]
		\State \textit{rango} $\gets 0.2$
		\State \textit{paso} $\gets \frac{rango}{size(grupo) - 1}$
		\State \textit{ordenSatisfacción} $\gets$ \textbf{Ordenar} \textit{valoraciones[películaRecomendada]}
		\For{\textit{posición} \textbf{in} \textit{ordenSatisfacción}}
		\State \textit{pesos[posición]} $\gets -\frac{rango}{2} + paso \times $\textit{posición}
		\EndFor
		\State \textbf{return} \textit{pesos}
	\end{algorithmic}
\end{algorithm}

En el pseudocódigo se pueden observar dos algoritmos distinguidos: el primero representa el grueso del método, con todo el proceso del sistema de recomendación y que devuelve el ranking final; el segundo es el algoritmo que actualiza los pesos para cada miembro del grupo en función de cuánto les ha gustado la película. En las siguientes líneas se entenderán qué son estos pesos y cómo afectan al criterio de selección diseñado.

En primer lugar, se analizará el algoritmo general del sistema de recomendación. Este método tiene una clara diferencia que destaca sobre el algoritmo del estado del arte, y es la presencia de \textbf{pesos} que ponderan la relevancia de cada miembro del grupo, entendiendo por relevancia lo mucho que puede influir un miembro en la toma de una decisión determinada en el transcurso de la construcción del ranking final. Es decir, estos pesos tienen que ser \textbf{dinámicos} para adaptarse a las circunstancias que se vayan aprendiendo de las iteraciones anteriores.

La inicialización de valores que se da al comienzo del algoritmo conlleva la creación de un vector de pesos que, por el momento, debe valorar a todos los usuarios por igual. Se entiende que se parte desde un punto base en el que ningún usuario está más satisfecho que otro, por lo tanto todos tienen la misma importancia a la hora de tomar una decisión sobre qué película deben escoger. Para lograr esta funcionalidad, a cada usuario de un grupo $G$ debe serle asignado un valor equivalente a $\frac{1}{|G|}$, siendo $|G|$ la cardinalidad de dicho grupo, y así conseguir que todos aporten el mismo porcentaje a la decisión final.

Para poder comenzar a recomendar cualquier película a un grupo, es necesario que se cuente con una estimación de lo que cada miembro va a valorar dicha película. Esto se consigue mediante \textbf{predicción} -- el método utilizado para ello se explicará en detalle en el apartado correspondiente a experimentación, dado que se puede sustituir fácilmente en función del estudio que se quiera realizar, y qué algoritmo se elija para predecir estas valoraciones no implica cambio alguno en cuanto a cómo se desarrolla el método.

Con la matriz de valoraciones obtenida (películas x miembros del grupo) y los pesos inicializados, se comienza un bucle del que obtener en cada iteración la película seleccionada para ser incluida en el ranking. Para ello, lo primero que hay que hacer es computar los pesos para cada usuario, dándoles a la valoración de cada uno un coeficiente de modificación que se corresponda a la importancia que han de tener en la decisión pertinente. Una vez obtenidas las valoraciones ponderadas, sumando dichas valoraciones para cada película se calcula cuál obtiene un resultado mayor, y por tanto \textbf{es la película recomendada}. El último paso de este bucle es añadir la película al ranking final (por supuesto, ordenado), eliminarla de la lista de películas y de la matriz de valoraciones, y \textbf{recalcular los pesos} asignados a cada usuario.

Al tratarse de un método un poco más complejo, se ha decidido separar este algoritmo del pseudocódigo del sistema de recomendación, y en cierto modo también realizar un paréntesis en la explicación del mismo para analizar cómo se actualizan los pesos de los usuarios en este método en particular. Como se ha indicado anteriormente, la funcionalidad principal que se persigue con este método es que los usuarios queden \textbf{satisfechos de forma empática}, es decir, se busca propiciar que los usuarios que no han visto películas que les gustan tengan más voz a la hora de escoger la siguiente. En este algoritmo se implementa una funcionalidad similar a la del algoritmo AdaBoost \cite{adaboost}, disminuyendo el peso de los miembros del grupo satisfechos y aumentando el de aquellos a los que la película les gusta menos. En este caso, los valores no pueden aumentar por encima de 1 y no pueden disminuir por debajo de 0 -- esto tiene especial sentido viéndolo desde el punto de vista del lenguaje natural como que nunca se debe ``fastidiar'' a un miembro del grupo por equilibrar la balanza, es decir, no se quiere dar una influencia negativa a tal usuario. Como mucho, si se da el caso de que dicho usuario está encantado con todas las películas, puede acabar con peso 0 significando esto que no tomará parte en la decisión de la próxima película.

El algoritmo de actualización de pesos empático funciona de la siguiente manera. En primer lugar se ha de fijar un valor para el rango de modificación de los pesos, que englobe por encima y por debajo del 0. En este caso se ha escogido el valor de rango $0.2$ tras una serie de pruebas manuales previas al experimento. Este rango provoca que la fluctuación de pesos pueda ir desde un $-0.1$ hasta un $+0.1$. Como la idea es que los miembros se distribuyan en ese espacio, se ha de calcular un \textit{paso} que especifique el escalón que ha de darse entre cada usuario.

Por ejemplo, para poder dar cabida a los 5 usuarios de un grupo G debe existir un paso equivalente a $\frac{r}{|G|-1}$, siendo $r$ el rango previamente definido y $|G|$ la cardinalidad del grupo. De esta forma, el valor del paso sería $p = 0.05$ y los usuarios se distribuirán con los valores $\{-0.1, -0.05, 0, 0.05, 0.1\}$ en función de su satisfacción con la película seleccionada.

A continuación se calcula, en función de la \textbf{valoración original} predicha para cada usuario, no de la valoración ponderada obtenida de multiplicar la predicción por los pesos, el orden de satisfacción de los usuarios con dicha película. Este orden será el que indique qué fluctuación de pesos se le otorga a los usuarios, y así el que más satisfecho haya quedado tendrá un 10\% menos de influencia en la siguiente película, así como el que menos haya quedado tendrá un 10\% más.

Por último, como se ha especificado anteriormente, es necesario limitar los valores obtenidos tras la fluctuación al rango $[0,1]$ para que la recomendación tenga sentido desde el punto de vista social en todo momento, que en última instancia es lo que se busca con este experimento; no solo obtener un resultado eficaz, sino comprobar cómo es capaz de comportarse un algoritmo que actúe de manera similar a como lo haría un ser humano.

Una vez entendido cómo funciona la actualización de pesos para el método de empatía, solo queda repetir el bucle hasta que todas las películas hayan sido clasificadas y ordenadas, y devolver el ranking correspondiente. De acuerdo al propósito del método, dicho ranking habrá tenido en cuenta mantener, a lo largo de todas las decisiones, un equilibrio que intente causar la mayor satisfacción global, pero sobre todo que logre que ningún usuario se sienta maltratado por el sistema.

